# GA Software Engineering Immersive: Project 4

# LifeStat app

The app aims to automatically sync information from various devices and trackers, eliminating the need for manual input and ensuring real-time analysis of user behavior. Users can import data from their smartphones and fitness wearables such as Oura Ring, Fitbit, Apple Watch, Strava, and Spotify, consolidating health and lifestyle data for comprehensive insights (NOTE: Just Oura through personal access token available for now!).
Through combining and analyzing imported data, the app aim to identify relationships between variables like sleep, stress, diet, activity, and productivity, empowering users to gain a deeper understanding of their overall well-being. Additionally, users can access visualizations and reports generated by the app, which highlight patterns and trends in their data, facilitating insights into factors contributing to happiness, activity levels, and productivity.

## Technologies Used

![PostgreSQL](/public/postgreSQL.png)
![Express](/public/express.png)
![React](/public/react.png)
![Node.js](/public/node.js.png)
![JS](/public/js.png)
![HTML5](/public/html5.png)
![CSS](/public/css.png)
![npm](/public/npm.png)
![Material UI](/public/material_ui.png)
![Postman](/public/postman.png)

## Getting Started

### Postman Collection

Postman collection with all the endpoints created on the backend so you can run to check registration, login and Data entries CRUD, along with seeds to facilitate testing.
Export from here and import in Postman: [LifeStat Postman Collection](/public/LifeStat.postman_collection.json)

![Postman_Env](/public/postman_environment.png)

**NOTE:** Make sure you create a separate postman environment (like in the picture above) so you can include your access_token and refresh_token, that will be inherited by the requests in your collection.

### Backend Configuration

- Go to the project backend folder and create a new package.json file

`npm init - y`

- Install the packages:

`npm i dotenv express-validator jsonwebtoken bcrypt uuid cors helmet express-rate-limit sequelize pq`

- **dotenv:** A package used to load environment variables from a .env file into process.env.
- **Express-validator:** A set of middleware functions to validate input data in Express.js applications.
- **mongoose:** An Object Data Modeling (ODM) library for MongoDB and Node.js, providing a straight-forward, schema-based solution to model application data.
- **Jsonwebtoken:** A library to create and verify JSON Web Tokens (JWT) for secure communication between parties.
- **bcrypt:** A library to help hash passwords securely.
- **Uuid:** A package to generate universally unique identifiers (UUIDs).
- **Cors:** A package to enable CORS (Cross-Origin Resource Sharing) in Express.js applications, allowing controlled access to resources from other domains.
- **Helmet:** A package to secure Express.js apps by setting various HTTP headers.
- **Express-rate-limit:** A middleware to limit repeated requests to your API to protect against abuse and improve stability.
- **Sequelize:** An ORM (Object-Relational Mapping) library for Node.js, providing easy access to PostgreSQL databases by mapping database entries to JavaScript objects.
- **PostgreSQL (pg):** A powerful open-source relational database management system, used for handling structured data with advanced features such as ACID compliance and support for complex queries.

#### Database Setup steps (before running backend server):

- Open terminal and run
- Install PostgreSQL (I am using Homebrew Package manager) `brew install postgresql@15`
- Download and install pgadmin (check the version for your OS)
  `https://www.postgresql.org/ftp/pgadmin/pgadmin4/v8.5/macos/`
- Check if service is running `Brew services list`
  - If not just start the service `brew services start postgresql@15`
- Run `psql postgres`
  - if you can't get into postgres cd into root `cd ~`
  - Get the postgre path `cat .zshrc`
  - Check if it is listing the PATH for postgresql like the example: `export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"`
  - If not run `Nano .zshrc`
  - Add the PATH (if not this one check the directories that lead to it so you can get the exact path) `export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"`
- Create database `create database lifestat;`
- Connect to database `\c lifestat`
- Grant permission on schema `grant all on schema public to db_lifestat_user;`
- Grant create permission `grant create on database lifestat to db_lifestat_user;`
- We are using UUID on each table so create extension `create extension if not exists "uuid-ossp";`
- Create your .env and add the database path (like below for localhost)

  `DATABASE=postgres://db_lifestat_user:<YOUR_DB_USER_PASSWORD>@localhost:5432/lifestat`

  `ACCESS_SECRET=<YOUR_ACCESS_SECRET>`

  `REFRESH_SECRET=<YOUR_REFRESH_SECRET>`

  **NOTE:** We've generated our ACCESS and REFRESH secrets using https://www.random.org/strings/

- Run backend server (tables will be created automatically, according to Models): `npm run dev`
- Run Seeding (postman) for Categories and Sources to automatically create the initial records, respectively.

### Frontend Configuration

- Get your personal access token at:

  - https://cloud.ouraring.com/docs/API

- Create .env file and add the following:

  `VITE_OURA_API_SLEEP_URL=https://cloud.ouraring.com/v2/usercollection/daily_sleep`

  `VITE_OURA_API_SLEEP_URL=https://api.ouraring.com/v2/usercollection/sleep`

  `VITE_OURA_API_KEY==<YOUR_PERSONAL_ACCESS_TOKEN>`

  `VITE_SERVER=http://localhost:5002`

- Install the packages:

  - Go to the project frontend folder and install react-app:
    `npm i`
  - Install react-router-dom:
    `npm install react-router-dom`

  - Install react-pro-sidebar:
    `npm install react-pro-sidebar`

  - Install Material UI:
    `npm install @mui/material @emotion/react @emotion/styled`

  - Install Material UI Icons:
    `npm install @mui/icons-material`

  - Install D3 library
    `npm install d3`

  - Install d3-delaunay@6
    `npm install d3-delaunay@6`

  - Install Observable standard library
    `npm i @observablehq/stdlib`

  - Install Material UI
    `npm install @material-ui/core`

  - Install jwt-decode
    `npm i jwt-decode`

  - Oura API requires CORS for fetching data so you can access this link and request temporary access to this demo server:
    `https://cors-anywhere.herokuapp.com/corsdemo`

## Main Features

### Login & Registration

The Register Controller manages user registration by securely storing hashed passwords and usernames in the Users collection of Postgre, after validating the registration data. On the other hand, the Login Controller authenticates users by verifying their credentials against the Postgre data. Upon successful authentication, it issues a JWT access token, enabling authorized access to protected routes.

### Oura data fetch

Custom React hook useGetOura is responsible for fetching sleep data (for now, activities and health & body data later) from the Oura API. It sets up a state variable ouraData using the useState hook to store the fetched data. The fetchData function is an asynchronous function that performs the API request using fetch and handles the response accordingly. CORS restrictions are bypassed using a proxy URL. The hook is invoked when the component mounts using the useEffect hook with an empty dependency array to ensure it runs only once. Finally, it returns the ouraData state variable for consumption by DisplaySleep.jsx component.

### Database management & CRUD

The Models components use Sequelize ORM (Object-Relational Mapping) to create and manage data entries within a PostgreSQL database. e.g. DataEntries.js defines the DataEntries model with columns for entry_id, entry_day, entry_value, and entry_type, specifying their respective data types. Associations with the Users, DataSources, and DataCategories models are established to represent relationships between data entries and users, data sources, and data categories. Finally, the DataEntries model is exported for use in other parts of the application.

![LifeStat ERD](/public/LifeStat_ERD.png)

Controller components implements several functionalities for managing and analyzing data entries in the database.

- e.g. (1) dataEntries.js addEntry function handles the creation of a single data entry, checking for existing entries and inserting the new entry if it doesn't already exist. The bulkAddEntry function allows for the creation of multiple data entries at once, skipping duplicates. Additionally, the getTotalSleepDuration function queries the database to calculate the total sleep duration per day and returns the results, transforming the data to a more readable format before sending it as a response.
- e.g. (2) Users controller and Router provides a set of functionalities for user management within the web app. It includes methods for seeding the database with initial user records, registering new users with hashed passwords, logging in users with email and password verification, refreshing authentication tokens, updating user information, deleting user accounts, fetching all user information, and retrieving specific user details by user ID. Each method handles potential errors and provides appropriate responses to client requests.

### Visualizations & Reports

- Stippling

![About page - Stippling](/public/About-Stippling.png)

- Histogram

![Main page - Histogram](/public/TotalSleepDuration-Histogram.png)

- LineChart: just component with sample data for learning and testing
- TimeSeries: just component with sample data for learning and testing

## Some Interesting stuff...

- Login types and different accesses to endpoints and features like users management (for admins)
- Sequelize ORM (Object-Relational Mapping) library for Node.js, providing easy access to PostgreSQL by mapping database entries to JavaScript objects.
- D3 (or D3.js) is a free, open-source JavaScript library for visualizing data, offering flexibility in authoring dynamic, data-driven graphics.

## Next Steps

- Forgot my password feature on Login
- Create Privacy Policy and Terms of Service in order to register app with Oura and allow for integration and oura authentication instead of using personal access token
- Create other visualizations and data relationships / correlations
- add other trackers like fitbit, garmin, and so on
- create personalized reports
